<Window x:Class="Munin.UI.Views.ScriptManagerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:loc="clr-namespace:Munin.UI.Localization"
        xmlns:avalon="http://icsharpcode.net/sharpdevelop/avalonedit"
        Title="{loc:Localize Key=ScriptManager_Title}"
        Height="750" Width="1050"
        MinHeight="500" MinWidth="800"
        WindowStyle="None"
        AllowsTransparency="True"
        ResizeMode="CanResizeWithGrip"
        Background="Transparent"
        WindowStartupLocation="CenterOwner">
    
    <Border Background="{StaticResource BackgroundDarkBrush}"
            CornerRadius="8"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Custom Title Bar -->
            <Border Grid.Row="0" 
                    Background="{StaticResource BackgroundMediumBrush}"
                    CornerRadius="8,8,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid Height="36">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="12,0,0,0" VerticalAlignment="Center">
                        <TextBlock Text="ðŸ“œ" FontSize="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="{loc:Localize Key=ScriptManager_Title}" 
                                   FontSize="13" 
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <Button Click="MinimizeButton_Click"
                                Style="{StaticResource WindowControlButtonStyle}">
                            <Path Data="M0,5 H10" 
                                  Stroke="{StaticResource TextSecondaryBrush}" 
                                  StrokeThickness="1"
                                  Width="10" Height="10"/>
                        </Button>
                        <Button x:Name="MaximizeButton"
                                Click="MaximizeButton_Click"
                                Style="{StaticResource WindowControlButtonStyle}">
                            <Path x:Name="MaximizeIcon"
                                  Data="M0,0 H10 V10 H0 Z" 
                                  Stroke="{StaticResource TextSecondaryBrush}" 
                                  StrokeThickness="1"
                                  Fill="Transparent"
                                  Width="10" Height="10"/>
                        </Button>
                        <Button Click="CloseButton_Click"
                                Style="{StaticResource WindowCloseButtonStyle}">
                            <Path Data="M0,0 L10,10 M10,0 L0,10" 
                                  Stroke="{StaticResource TextSecondaryBrush}" 
                                  StrokeThickness="1"
                                  Width="10" Height="10"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
        
            <!-- Header -->
            <Border Grid.Row="1" 
                    Background="{StaticResource BackgroundMediumBrush}"
                    Padding="15,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock x:Name="LoadedCountText"
                                       Text="0 scripts loaded"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       FontSize="12"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button x:Name="OpenFolderButton"
                                Content="{loc:Localize Key=ScriptManager_OpenFolder}"
                                Click="OpenFolderButton_Click"
                                Padding="12,6" Margin="0,0,8,0"/>
                        <Button x:Name="ReloadAllButton"
                                Content="{loc:Localize Key=ScriptManager_ReloadAll}"
                                Click="ReloadAllButton_Click"
                                Padding="12,6"/>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- Main Content with Tabs -->
            <TabControl Grid.Row="2" 
                        x:Name="MainTabControl"
                        Background="Transparent"
                        Margin="10">
                
                <!-- Script Editor Tab -->
            <TabItem x:Name="EditorTab">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âœï¸" Margin="0,0,6,0"/>
                        <TextBlock Text="{loc:Localize Key=ScriptManager_EditorTab}"/>
                    </StackPanel>
                </TabItem.Header>
                <Grid Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- File Tree -->
                    <Border Grid.Column="0" 
                            Background="{DynamicResource SidebarBackgroundBrush}"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1" CornerRadius="4">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" 
                                       Text="{loc:Localize Key=ScriptManager_Files}"
                                       FontWeight="SemiBold" Padding="10,8"
                                       Foreground="{DynamicResource ForegroundBrush}"/>
                            
                            <TreeView x:Name="FileTreeView"
                                      Grid.Row="1"
                                      Background="Transparent"
                                      BorderThickness="0"
                                      SelectedItemChanged="FileTreeView_SelectedItemChanged"/>
                            
                            <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="5">
                                <Button x:Name="NewScriptButton" Content="âž•" ToolTip="{loc:Localize Key=ScriptManager_NewScript}"
                                        Padding="8,4" Margin="2" Click="NewScriptButton_Click"/>
                                <Button x:Name="NewTriggerButton" Content="âš¡" ToolTip="{loc:Localize Key=ScriptManager_NewTrigger}"
                                        Padding="8,4" Margin="2" Click="NewTriggerButton_Click"/>
                                <Button x:Name="DeleteFileButton" Content="ðŸ—‘ï¸" ToolTip="{loc:Localize Key=ScriptManager_Delete}"
                                        Padding="8,4" Margin="2" Click="DeleteFileButton_Click"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="Transparent"/>
                    
                    <!-- Editor Panel -->
                    <Border Grid.Column="2" 
                            Background="{DynamicResource ChannelBackgroundBrush}"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1" CornerRadius="4">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Editor Toolbar -->
                            <Border Grid.Row="0" 
                                    Background="{DynamicResource SidebarBackgroundBrush}"
                                    Padding="8,5">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock x:Name="CurrentFileLabel"
                                               Grid.Column="0"
                                               Text="{loc:Localize Key=ScriptManager_NoFileSelected}"
                                               Foreground="{DynamicResource SecondaryForegroundBrush}"
                                               VerticalAlignment="Center"/>
                                    
                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <Button x:Name="SaveButton" Content="{loc:Localize Key=ScriptManager_Save}"
                                                Padding="10,4" Margin="0,0,5,0"
                                                Click="SaveButton_Click" IsEnabled="False"/>
                                        <Button x:Name="RunButton" Content="{loc:Localize Key=ScriptManager_Run}"
                                                Padding="10,4" Style="{DynamicResource AccentButtonStyle}"
                                                Click="RunButton_Click" IsEnabled="False"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                            
                            <!-- Code Editor (AvalonEdit) -->
                            <avalon:TextEditor x:Name="CodeEditor"
                                     Grid.Row="1"
                                     FontFamily="Cascadia Code, Consolas, Courier New"
                                     FontSize="13"
                                     ShowLineNumbers="True"
                                     Background="{DynamicResource InputBackgroundBrush}"
                                     Foreground="{DynamicResource ForegroundBrush}"
                                     LineNumbersForeground="{StaticResource TextMutedBrush}"
                                     BorderThickness="0"
                                     Padding="5"
                                     HorizontalScrollBarVisibility="Auto"
                                     VerticalScrollBarVisibility="Auto"
                                     TextChanged="CodeEditor_TextChanged"/>
                            
                            <!-- Output Panel -->
                            <Expander Grid.Row="2" 
                                      Header="{loc:Localize Key=ScriptManager_Output}"
                                      IsExpanded="True" Padding="0">
                                <Border Background="{DynamicResource SidebarBackgroundBrush}"
                                        MaxHeight="150">
                                    <TextBox x:Name="OutputText"
                                             FontFamily="Consolas"
                                             FontSize="12"
                                             Foreground="{DynamicResource SecondaryForegroundBrush}"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             IsReadOnly="True"
                                             TextWrapping="Wrap"
                                             VerticalScrollBarVisibility="Auto"
                                             Padding="10,5"/>
                                </Border>
                            </Expander>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>
            
            <!-- Script List Tab -->
            <TabItem x:Name="ListTab">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“‹" Margin="0,0,6,0"/>
                        <TextBlock Text="{loc:Localize Key=ScriptManager_ListTab}"/>
                    </StackPanel>
                </TabItem.Header>
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Search/Filter -->
                    <Grid Grid.Row="0" Margin="0,0,0,10">
                        <TextBox x:Name="ScriptSearchBox"
                                 Padding="8" 
                                 Background="{DynamicResource InputBackgroundBrush}"
                                 Foreground="{DynamicResource ForegroundBrush}"
                                 TextChanged="ScriptSearchBox_TextChanged"/>
                        <TextBlock Text="{loc:Localize Key=ScriptManager_SearchPlaceholder}"
                                   IsHitTestVisible="False" Padding="10,8"
                                   Foreground="{DynamicResource PlaceholderForegroundBrush}"
                                   Visibility="{Binding Text.Length, ElementName=ScriptSearchBox, Converter={StaticResource ZeroToVisibleConverter}}"/>
                    </Grid>
                    
                    <!-- Script List -->
                    <ListView x:Name="ScriptListView"
                              Grid.Row="1"
                              Background="Transparent"
                              BorderThickness="0">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource SidebarBackgroundBrush}"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="1" CornerRadius="6"
                                        Padding="12,10" Margin="0,2">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Enable Toggle -->
                                        <CheckBox Grid.Column="0"
                                                  IsChecked="{Binding IsEnabled}"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,12,0"
                                                  Checked="ScriptToggle_Changed"
                                                  Unchecked="ScriptToggle_Changed"/>
                                        
                                        <!-- Script Info -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding TypeIcon}" Margin="0,0,6,0"/>
                                                <TextBlock Text="{Binding Name}" 
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource ForegroundBrush}"/>
                                            </StackPanel>
                                            <TextBlock Text="{Binding FilePath}" 
                                                       FontSize="11"
                                                       Foreground="{DynamicResource SecondaryForegroundBrush}"/>
                                            <TextBlock Text="{Binding LoadedAt, StringFormat='Loaded: {0:HH:mm:ss}'}" 
                                                       FontSize="10"
                                                       Foreground="{DynamicResource PlaceholderForegroundBrush}"/>
                                        </StackPanel>
                                        
                                        <!-- Actions -->
                                        <StackPanel Grid.Column="2" 
                                                    Orientation="Horizontal"
                                                    VerticalAlignment="Center">
                                            <Button Content="ðŸ”„" ToolTip="{loc:Localize Key=ScriptManager_Reload}"
                                                    Padding="8,4" Margin="2"
                                                    Click="ReloadScriptButton_Click"
                                                    Tag="{Binding Name}"/>
                                            <Button Content="âœï¸" ToolTip="{loc:Localize Key=ScriptManager_Edit}"
                                                    Padding="8,4" Margin="2"
                                                    Click="EditScriptButton_Click"
                                                    Tag="{Binding FilePath}"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </TabItem>
            
            <!-- Trigger Builder Tab -->
            <TabItem x:Name="TriggerTab">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âš¡" Margin="0,0,6,0"/>
                        <TextBlock Text="{loc:Localize Key=ScriptManager_TriggerTab}"/>
                    </StackPanel>
                </TabItem.Header>
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Trigger Builder Header -->
                    <TextBlock Grid.Row="0" 
                               Text="{loc:Localize Key=ScriptManager_TriggerBuilderDesc}"
                               Foreground="{DynamicResource SecondaryForegroundBrush}"
                               Margin="0,0,0,15"/>
                    
                    <!-- Trigger List -->
                    <ListView x:Name="TriggerListView"
                              Grid.Row="1"
                              Background="Transparent"
                              BorderThickness="0"
                              SelectionChanged="TriggerListView_SelectionChanged">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource SidebarBackgroundBrush}"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="1" CornerRadius="6"
                                        Padding="15,12" Margin="0,3">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <CheckBox Grid.Column="0" 
                                                  IsChecked="{Binding IsEnabled}"
                                                  VerticalAlignment="Center" Margin="0,0,12,0"/>
                                        
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{Binding DisplayName}" 
                                                       FontWeight="SemiBold"
                                                       Foreground="{DynamicResource ForegroundBrush}"/>
                                            <TextBlock Foreground="{DynamicResource SecondaryForegroundBrush}"
                                                       FontSize="12">
                                                <Run Text="When"/>
                                                <Run Text="{Binding EventType}" FontWeight="SemiBold"/>
                                                <Run Text="â†’"/>
                                                <Run Text="{Binding ActionSummary}"/>
                                            </TextBlock>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                                            <Button Content="âœï¸" Padding="6,3" Margin="2"
                                                    Click="EditTriggerButton_Click"
                                                    Tag="{Binding}"/>
                                            <Button Content="ðŸ—‘ï¸" Padding="6,3" Margin="2"
                                                    Click="DeleteTriggerButton_Click"
                                                    Tag="{Binding}"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                    
                    <!-- Add New Trigger Button -->
                    <Button Grid.Row="2"
                            x:Name="AddTriggerButton"
                            Content="{loc:Localize Key=ScriptManager_AddTrigger}"
                            Click="AddTriggerButton_Click"
                            HorizontalAlignment="Left"
                            Padding="15,8" Margin="0,10,0,0"
                            Style="{DynamicResource AccentButtonStyle}"/>
                </Grid>
            </TabItem>
            
            <!-- Quick Actions Tab -->
            <TabItem x:Name="QuickActionsTab">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸš€" Margin="0,0,6,0"/>
                        <TextBlock Text="{loc:Localize Key=ScriptManager_QuickActionsTab}"/>
                    </StackPanel>
                </TabItem.Header>
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <WrapPanel x:Name="QuickActionsPanel" Orientation="Horizontal">
                        <!-- Quick Action Cards will be added here -->
                    </WrapPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
        
        <!-- Footer -->
        <Border Grid.Row="3"
                Background="{StaticResource BackgroundMediumBrush}"
                CornerRadius="0,0,8,8"
                Padding="15,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock x:Name="StatusText"
                           Grid.Column="0"
                           Text="{loc:Localize Key=ScriptManager_Ready}"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>
                
                <Button Grid.Column="1"
                        Content="{loc:Localize Key=Common_Close}"
                        Padding="20,6"
                        Click="CloseButton_Click"/>
            </Grid>
        </Border>
        </Grid>
    </Border>
</Window>
